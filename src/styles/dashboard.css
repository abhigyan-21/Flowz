/* Dashboard Styles - Dark Glassmorphism */
/* Variables now in main.css */

.overlay-panel {
    width: 380px;
    max-width: 100%;
    height: calc(100vh - var(--header-height) - 40px);
    /* Adjust for padding */
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 24px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    box-shadow: var(--glass-shadow);
    border: var(--glass-border);
    pointer-events: auto;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease, transform 0.3s ease;
    /* overflow: hidden; Removed to let button protrude */
    position: relative;
    color: var(--text-primary);
}

/* Smooth appearance for selected location panel when shown */
.selected-location-panel--animated {
    will-change: transform, opacity;
}

.panel-content-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    gap: 16px;
}

.overlay-panel.collapsed {
    width: 60px;
    padding: 20px 10px;
}

/* Hide content when collapsed using the wrapper */
.overlay-panel.collapsed .panel-content-wrapper {
    opacity: 0;
    pointer-events: none;
    display: none;
}

/* Collapse Toggle Button */
.collapse-btn {
    position: absolute;
    top: 50%;
    right: -24px;
    /* Protrude */
    transform: translateY(-50%);
    width: 32px;
    height: 64px;
    background: var(--accent-color);
    border-radius: 0 16px 16px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 50;
    /* Ensure on top */
    color: white;
    box-shadow: 4px 0 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
}

.collapse-btn:hover {
    background: var(--color-primary-dark);
    width: 36px;
}

/* Toggles (Segmented Control look) */
.toggle-container {
    display: flex;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 4px;
    position: relative;
}

.toggle-btn {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    background: transparent;
    font-weight: 500;
    color: var(--text-secondary);
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.toggle-btn.active {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.sub-toggle {
    background: transparent;
    gap: 12px;
    padding: 0;
}

.sub-toggle .toggle-btn {
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 12px;
}

.sub-toggle .toggle-btn.active {
    background: rgba(56, 189, 248, 0.15);
    /* Tinted Blue */
    color: var(--accent-color);
    border-color: var(--accent-color);
}

/* Content Area */
.panel-scroll-content {
    flex: 1;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

/* Scrollbar styling for dark theme */
.panel-scroll-content::-webkit-scrollbar {
    width: 4px;
}

.panel-scroll-content::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
}

.alert-placeholder {
    background: rgba(255, 255, 255, 0.05);
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    color: var(--text-secondary);
    border: 1px dashed rgba(255, 255, 255, 0.1);
}

.btn-view-all {
    width: 100%;
    padding: 16px;
    background: rgba(30, 41, 59, 0.8);
    color: var(--text-primary);
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    margin-top: auto;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.2s;
}

.btn-view-all:hover {
    background: rgba(51, 65, 85, 0.8);
    border-color: var(--accent-color);
}

/* Alert Cards */
.alert-card {
    border-radius: 16px;
    padding: 20px;
    position: relative;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: all 0.2s ease;
    cursor: pointer;
    background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
    border: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.alert-card:hover {
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
}

/* Colored Accents */
.alert-card.high {
    background: linear-gradient(145deg, rgba(239, 68, 68, 0.1), rgba(15, 23, 42, 0.6));
    border-left: 4px solid #EF4444;
}

.alert-card.moderate {
    background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(15, 23, 42, 0.6));
    border-left: 4px solid #F59E0B;
}

.alert-card.info {
    background: linear-gradient(145deg, rgba(14, 165, 233, 0.1), rgba(15, 23, 42, 0.6));
    border-left: 4px solid #0EA5E9;
}

.badge-recommended {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(16, 185, 129, 0.2);
    color: #34D399;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.alert-body h3 {
    margin-bottom: 6px;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.alert-body p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .overlay-panel {
        width: 100%;
        max-width: 100%;
        height: auto;
        /* Expanded state max-height */
        max-height: 80vh;
        border-radius: 20px 20px 0 0;
        padding: 16px;
        margin-bottom: 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);

        /* Smooth animation for height changes */
        transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
        overflow: visible;
        /* CRITICAL: Must be visible for button to show */
        display: flex;
        flex-direction: column;
        display: flex;
        flex-direction: column;
    }

    /* Wrapper now handled globally */

    .overlay-panel.collapsed {
        width: 100%;
        /* Collapsed state max-height (just enough for the bar) */
        max-height: 60px;
        min-height: 60px;
        /* Ensure at least this tall */
        padding: 0 16px;
        /* Reduce padding */

        /* When collapsed, we rely on the wrapper clipping content. 
           We don't need flex row justification here anymore because content is inside wrapper.
           We might want to center the "Tap to expand" text though.
        */
        justify-content: center;
    }

    /* Since we wrapped content, the "Tap to expand" pseudo-element needs to be positioned relative to panel */
    .overlay-panel.collapsed::after {
        content: "Tap to expand";
        color: var(--text-secondary);
        font-size: 0.9rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        white-space: nowrap;
        opacity: 1;
        transition: opacity 0.3s;
    }

    /* Hide wrapper content when collapsed? 
       If max-height is 60px, the top of the wrapper (tabs) might still show.
       Ideally we fade it out or hide it.
    */
    .overlay-panel.collapsed .panel-content-wrapper {
        opacity: 0;
        pointer-events: none;
    }

    /* When collapsed, we might want to show at least the toggle or a summary? 
       For now, let's just make it a small bar. */

    .collapse-btn {
        top: -24px;
        /* Position above the panel */
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        /* Remove rotation, keep centered */
        width: 48px;
        height: 24px;
        border-radius: 12px 12px 0 0;
    }

    .collapse-btn svg {
        transform: rotate(-90deg);
        /* Rotate the icon (ChevronRight > becomes Up ^) */
        transition: transform 0.3s;
    }

    .overlay-panel.collapsed .collapse-btn {
        /* When collapsed, it points up (which is expand). 
           Wait, logic is: isCollapsed ? Right (Expand) : Left (Collapse).
           If I rotate -90deg:
           ChevronLeft becomes ChevronUp (Collapse)
           ChevronRight becomes ChevronDown (Expand) - wait,
           ChevronRight (>) rotate(-90) -> Down (v). 
           ChevronLeft (<) rotate(-90) -> Up (^).
           
           Logic in JSX: isCollapsed ? ChevronRight : ChevronLeft.
           isCollapsed=true (Bar at bottom) -> Show ChevronRight -> Rotated -90 -> Down? 
           This is confusing. Let's just override the Icon in CSS? No, can't change Icon SVG path in CSS.
           We can rotate the container differently based on state.
           if isCollapsed (needs expand) -> we want UP arrow. 
           JSX shows ChevronRight. Right -> Up requires rotate(-90). Correct.

           if !isCollapsed (open) -> we want DOWN arrow.
           JSX shows ChevronLeft. Left -> Down requires rotate(-90). Correct.
        */
        top: -24px;
        transform: translateX(-50%);
        /* Icon rotation handles direction */
    }

    /* Ensure content is scrollable within limits */
    .panel-scroll-content {
        max-height: calc(60vh - 80px);
        /* Adjust for header/padding */
    }

    /* Adjust cards for mobile */
    .toggle-btn {
        font-size: 0.85rem;
        padding: 8px;
    }

    /* Hide the collapsed content completely to avoid spacing issues */
    .overlay-panel.collapsed .toggle-container,
    .overlay-panel.collapsed .panel-scroll-content,
    .overlay-panel.collapsed .btn-view-all {
        display: none;
    }

    /* Maybe show a "Tap to expand" text when collapsed? */
    .overlay-panel.collapsed::after {
        content: "Tap to expand";
        color: var(--text-secondary);
        font-size: 0.9rem;
        position: absolute;
        width: 100%;
        text-align: center;
        top: 20px;
        pointer-events: none;
    }
}